from scripts.utils.gspread_client import get_gspread_client
from gspread_dataframe import set_with_dataframe
from scripts.utils.config.factory import sheets_names, tables_names
from scripts.utils.telegram_logger import send_tg_message
from scripts.utils.setup_logger import make_logger
import pandas as pd


logger = make_logger(__name__, use_telegram=False)


def price_transfer_from_am_in_am_oz() -> None:
    """
    ğŸ”„ ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ Ğ¿Ñ€Ğ°Ğ¹ÑĞ° Ğ¸Ğ· Â«ĞÑÑĞ¾Ñ€Ñ‚Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ½Ğ°Ñ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ°. ĞŸĞ¾Ğ»Ğ½Ğ°Ñ (WB)Â» Ğ² Â«ĞÑÑĞ¾Ñ€Ñ‚Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ½Ğ°Ñ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ° OZONÂ»

    Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ñƒ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ»Ğ¸ÑÑ‚Ğ° Google Sheets (`Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº WB`)
    Ğ¸Ğ· Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ WB Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ OZON. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¼Ğ°Ñ€ĞºĞµÑ‚Ğ¿Ğ»ĞµĞ¹ÑĞ°Ğ¼Ğ¸.

    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    ğŸ“¥ Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº: 
        - Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: "ĞÑÑĞ¾Ñ€Ñ‚Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ½Ğ°Ñ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ°. ĞŸĞ¾Ğ»Ğ½Ğ°Ñ"
        - Ğ›Ğ¸ÑÑ‚: "Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº WB" (Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ· `sheets_names()['directory_wb']`)

    ğŸ“¤ ĞŸÑ€Ğ¸Ñ‘Ğ¼Ğ½Ğ¸Ğº: 
        - Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: "ĞÑÑĞ¾Ñ€Ñ‚Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ½Ğ°Ñ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ° OZON"
        - Ğ›Ğ¸ÑÑ‚: Ñ‚Ğ°ĞºĞ¾Ğ¹ Ğ¶Ğµ ("Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº WB")

    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    ğŸ“¦ Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚:

    1. ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·ÑƒĞµÑ‚ÑÑ Ğ² Google Sheets Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ service account.
    2. ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ»Ğ¸ÑÑ‚ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¸Ğ· WB.
    3. Ğ¡Ñ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²ÑĞµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ¸ Ğ¿Ñ€ĞµĞ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¸Ñ… Ğ² pandas DataFrame.
    4. ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¹ Ğ»Ğ¸ÑÑ‚ Ğ² OZON.
    5. Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² OZON Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸ĞµĞ¼ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¾Ğ² ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ğ¾Ğ².
    6. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ»Ğ¾Ğ³Ğ¸ Ğ² Telegram Ğ¸ Ğ² Ğ»Ğ¾Ğ³Ğ³ĞµÑ€.

    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    ğŸ§¾ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹:
        - `get_gspread_client()` â†’ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ² Google Sheets
        - `set_with_dataframe()` â†’ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° pandas.DataFrame Ğ² Ğ»Ğ¸ÑÑ‚
        - `sheets_names()` â†’ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸ÑÑ‚Ğ° ("Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº WB")
        - `tables_names()` â†’ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ¸ Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
        - `send_tg_message()` â†’ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…/ÑƒÑĞ¿ĞµÑ…Ğµ Ğ² Telegram
        - `make_logger()` â†’ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€ Ñ Ñ†Ğ²ĞµÑ‚Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒÑ

    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    ğŸ’¡ ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ:
        - ĞŸÑ€ĞµĞ´Ğ¿Ğ¾Ğ»Ğ°Ğ³Ğ°ĞµÑ‚ÑÑ, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ»Ğ¸ÑÑ‚Ğ¾Ğ² Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ğ°.
        - Ğ¡Ñ‚Ğ¾Ğ»Ğ±Ñ†Ñ‹ Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ, Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ÑÑ‚ÑÑ.
        - Ğ›Ğ¸ÑÑ‚ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ OZON Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½ Ğ¿ĞµÑ€ĞµĞ´ Ğ²ÑÑ‚Ğ°Ğ²ĞºĞ¾Ğ¹.

    ğŸ§‘â€ğŸ’» ĞĞ²Ñ‚Ğ¾Ñ€: Ğ˜Ğ»ÑŒÑ
    ğŸ“… Ğ’ĞµÑ€ÑĞ¸Ñ: Ğ˜ÑĞ»ÑŒ 2025
    """

    gs = get_gspread_client()

    table_matrix_wb = tables_names()['wb_matrix_complete']
    table_matrix_oz = tables_names()['oz_matrix_complete']

    sheet_name = sheets_names()['directory_wb']

    logger.info(f"ğŸš€ Ğ¡Ñ‚Ğ°Ñ€Ñ‚ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: `{sheet_name}`")
    try:
        logger.info(
            "ğŸ“„ ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹: 'ĞÑÑĞ¾Ñ€Ñ‚Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ½Ğ°Ñ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ°. ĞŸĞ¾Ğ»Ğ½Ğ°Ñ' Ğ¸ 'ĞÑÑĞ¾Ñ€Ñ‚Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ½Ğ°Ñ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ° OZON'")
        transfer_spreadsheet = gs.open(table_matrix_wb)
        transfer_sheet = transfer_spreadsheet.worksheet(sheet_name)

        download_spreadsheet = gs.open(table_matrix_oz)
        download_sheet = download_spreadsheet.worksheet(sheet_name)

    except Exception as e:
        msg = f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¸Ğ»Ğ¸ Ğ»Ğ¸ÑÑ‚Ğ¾Ğ²: {e}"
        send_tg_message(msg)
        logger.error(msg)
        return

    try:
        logger.info(f"â¬‡ï¸ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ»Ğ¸ÑÑ‚Ğ° `{sheet_name}`")
        transfer_data = transfer_sheet.get_all_values()

        df_transfer = pd.DataFrame(transfer_data[1:], columns=transfer_data[0])
        logger.info(
            f"âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑÑ‡Ğ¸Ñ‚Ğ°Ğ½Ñ‹: {df_transfer.shape[0]} ÑÑ‚Ñ€Ğ¾Ğº, {df_transfer.shape[1]} ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ğ¾Ğ²")

    except Exception as e:
        msg = f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: {e}"
        send_tg_message(msg)
        logger.error(msg)
        return

    try:
        logger.info("ğŸ§¹ ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¹ Ğ»Ğ¸ÑÑ‚ Ğ¿ĞµÑ€ĞµĞ´ Ğ²ÑÑ‚Ğ°Ğ²ĞºĞ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…")
        download_sheet.clear()

        logger.info("ğŸ“¤ Ğ’Ñ‹Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² 'ĞÑÑĞ¾Ñ€Ñ‚Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ½Ğ°Ñ Ğ¼Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ° OZON'")
        set_with_dataframe(
            download_sheet,
            df_transfer,
            col=1,
            row=1,
            include_column_header=True,
            include_index=False
        )

        logger.info(
            f"âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ² `{sheet_name}` Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ OZON")
    except Exception as e:
        msg = f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Google Sheets: {e}"
        send_tg_message(msg)
        logger.error(msg)
        return

    send_tg_message("ğŸ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾ Ğ±ĞµĞ· Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº âœ…")


if __name__ == '__main__':
    send_tg_message(f"ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ `price_transfer_from_am_in_am_oz`")
    price_transfer_from_am_in_am_oz()
# py -m scripts.integrations.price_transfer_in_oz
